

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Deep learning and variational inversion to quantify and attribute climate change (CIRC23) &#8212; Environmental Data Science Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-3E20PWD938"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-3E20PWD938');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/gallery/93463cac-471a-469d-ad52-0514fd9b67f2/notebook';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Learning the underlying physics of a simulation model of the ocean’s temperature (CIRC23)" href="../3286b92f-4fae-4cc6-a29e-e408bc844542/notebook.html" />
    <link rel="prev" title="Variational data assimilation with deep prior (CIRC23)" href="../39d9c177-11da-41b2-9b64-63f4c1c834b3/notebook.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../../welcome.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="Environmental Data Science Book - Home"/>
    <script>document.write(`<img src="../../../_static/logo.png" class="logo__image only-dark" alt="Environmental Data Science Book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../welcome.html">
                    Welcome
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Preamble</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../preamble/about.html">About EDS book</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../../preamble/attribution.html">Citation and Reuse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../preamble/contribute.html">Contribute</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Notebooks</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../about.html">Our Notebooks</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../about/aims-and-scope.html">Aims and Scope</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../about/review-benefits.html">Benefits of Reviewing Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../about/notebooks-technologies.html">Technologies</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../../gallery.html">Gallery</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../39d9c177-11da-41b2-9b64-63f4c1c834b3/notebook.html">Variational data assimilation with deep prior (CIRC23)</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Deep learning and variational inversion for climate science (CIRC23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../3286b92f-4fae-4cc6-a29e-e408bc844542/notebook.html">Underlying physics of the ocean's temperature (CIRC23)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../b128b282-dee7-44a7-bc21-f1fd21452a83/notebook.html">Land Cover Data (Impact Observatory)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../435f534c-e49b-43c3-9bd6-3393100bef3f/notebook.html">Cosmos-UK Soil Moisture (UKCEH)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ea34568e-d86e-4720-be2f-3f826f66a26c/notebook.html">Rainfall NCEP/NCAR (NOAA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ac327c3a-5264-40a2-8c6e-1e8d7c4b37ef/notebook.html">Sea ice forecasting (IceNet)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../94486a7f-e046-461f-bbb9-334ec7b57040/notebook.html">Tree crown (DetectreeRGB)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bc30df18-fce2-42fa-aade-1ce5b7f3ca3c/notebook.html">SEVIRI Level 1.5 (EUMESAT)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../15d986da-2d7c-44fb-af71-700494485def/notebook.html">Tree crown (DeepForest)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../a2875cdc-ba6a-49dc-aab7-cdf7c4fc0fa8/notebook.html">MOD021KM and FIRMS (NASA)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1b8921af-e77f-4ccf-ae38-4813cdceba0f/notebook.html">UKV high-resolution (Met Office)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../b34facfa-cea8-48f5-89f6-f11ce00812a9/notebook.html">Detecting floating objects (ESA Phi-Lab)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../how-to.html">Usage</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Publishing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../publishing/guidelines.html">Our Guidelines</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../publishing/guidelines/guidelines-authors.html">Guide for Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../publishing/guidelines/guidelines-reviewers.html">Guide for Reviewers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../publishing/guidelines/guidelines-editors.html">Guide for Editors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../publishing/guidelines/guidelines-eic.html">Guide for Editor in Chief</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../publishing/guidelines/guidelines-community.html">Guide for Community</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../publishing/faq.html">FAQ</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../community/about.html">Our Community</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Afterword</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../afterword/bibliography.html">Bibliography</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/alan-turing-institute/environmental-ds-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/alan-turing-institute/environmental-ds-book/edit/master/book/notebooks/gallery/93463cac-471a-469d-ad52-0514fd9b67f2/notebook.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/alan-turing-institute/environmental-ds-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/gallery/93463cac-471a-469d-ad52-0514fd9b67f2/notebook.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/gallery/93463cac-471a-469d-ad52-0514fd9b67f2/notebook.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Deep learning and variational inversion to quantify and attribute climate change (CIRC23)</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#context">Context</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose">Purpose</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#highlights">Highlights</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#abbreviations">Abbreviations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contributions">Contributions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook">Notebook</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-codebase">Modelling codebase</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-publications">Modelling publications</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-documentation">Dataset documentation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#source-code">Source code</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-libraries">Load libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#settings">Settings</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variables">Variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classes">Classes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline">Pipeline</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fetch-data">Fetch data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cnn">CNN</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-training">Model training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-performance">Model performance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inverse-model">Inverse model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limitations">Limitations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citing-this-notebook">Citing this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-information">Additional information</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="deep-learning-and-variational-inversion-to-quantify-and-attribute-climate-change-circ23">
<h1>Deep learning and variational inversion to quantify and attribute climate change (CIRC23)<a class="headerlink" href="#deep-learning-and-variational-inversion-to-quantify-and-attribute-climate-change-circ23" title="Permalink to this heading">#</a></h1>
<p><span class="sd-sphinx-override sd-badge sd-bg-primary sd-bg-text-primary">General</span>
<span class="sd-sphinx-override sd-badge sd-bg-secondary sd-bg-text-secondary">Modelling</span>
<span class="sd-sphinx-override sd-badge sd-bg-warning sd-bg-text-warning">Special Issue</span>
<span class="sd-sphinx-override sd-badge sd-bg-info sd-bg-text-info">Python</span></p>
<p align="left">
    <a href="https://github.com/eds-book-gallery/93463cac-471a-469d-ad52-0514fd9b67f2/blob/main/LICENSE">
        <img alt="license" src="https://img.shields.io/badge/license-MIT-yellow.svg">
    </a>
    <a href="https://github.com/eds-book-gallery/93463cac-471a-469d-ad52-0514fd9b67f2/actions/workflows/render.yaml">
        <img alt="render" src="https://github.com/eds-book-gallery/93463cac-471a-469d-ad52-0514fd9b67f2/actions/workflows/render.yaml/badge.svg">
    </a>
    <a href="https://github.com/alan-turing-institute/environmental-ds-book/issues/173">
        <img alt="review" src="https://img.shields.io/badge/view-review-purple">
    </a>
    <br/>
</p>
<p align="left">
    <a href="http://mybinder.org/v2/gh/eds-book-gallery/93463cac-471a-469d-ad52-0514fd9b67f2/main?labpath=notebook.ipynb">
        <img alt="binder" src="https://mybinder.org/badge_logo.svg">
    </a>
    <a href="https://replay.notebooks.egi.eu/v2/gh/eds-book-gallery/93463cac-471a-469d-ad52-0514fd9b67f2/main?labpath=notebook.ipynb">
        <img alt="binder" src="https://img.shields.io/badge/launch-EGI%20binder-F5A252.svg?logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFkAAABZCAMAAABi1XidAAAB8lBMVEX///9XmsrmZYH1olJXmsr1olJXmsrmZYH1olJXmsr1olJXmsrmZYH1olL1olJXmsr1olJXmsrmZYH1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olJXmsrmZYH1olL1olL0nFf1olJXmsrmZYH1olJXmsq8dZb1olJXmsrmZYH1olJXmspXmspXmsr1olL1olJXmsrmZYH1olJXmsr1olL1olJXmsrmZYH1olL1olLeaIVXmsrmZYH1olL1olL1olJXmsrmZYH1olLna31Xmsr1olJXmsr1olJXmsrmZYH1olLqoVr1olJXmsr1olJXmsrmZYH1olL1olKkfaPobXvviGabgadXmsqThKuofKHmZ4Dobnr1olJXmsr1olJXmspXmsr1olJXmsrfZ4TuhWn1olL1olJXmsqBi7X1olJXmspZmslbmMhbmsdemsVfl8ZgmsNim8Jpk8F0m7R4m7F5nLB6jbh7jbiDirOEibOGnKaMhq+PnaCVg6qWg6qegKaff6WhnpKofKGtnomxeZy3noG6dZi+n3vCcpPDcpPGn3bLb4/Mb47UbIrVa4rYoGjdaIbeaIXhoWHmZYHobXvpcHjqdHXreHLroVrsfG/uhGnuh2bwj2Hxk17yl1vzmljzm1j0nlX1olL3AJXWAAAAbXRSTlMAEBAQHx8gICAuLjAwMDw9PUBAQEpQUFBXV1hgYGBkcHBwcXl8gICAgoiIkJCQlJicnJ2goKCmqK+wsLC4usDAwMjP0NDQ1NbW3Nzg4ODi5+3v8PDw8/T09PX29vb39/f5+fr7+/z8/Pz9/v7+zczCxgAABC5JREFUeAHN1ul3k0UUBvCb1CTVpmpaitAGSLSpSuKCLWpbTKNJFGlcSMAFF63iUmRccNG6gLbuxkXU66JAUef/9LSpmXnyLr3T5AO/rzl5zj137p136BISy44fKJXuGN/d19PUfYeO67Znqtf2KH33Id1psXoFdW30sPZ1sMvs2D060AHqws4FHeJojLZqnw53cmfvg+XR8mC0OEjuxrXEkX5ydeVJLVIlV0e10PXk5k7dYeHu7Cj1j+49uKg7uLU61tGLw1lq27ugQYlclHC4bgv7VQ+TAyj5Zc/UjsPvs1sd5cWryWObtvWT2EPa4rtnWW3JkpjggEpbOsPr7F7EyNewtpBIslA7p43HCsnwooXTEc3UmPmCNn5lrqTJxy6nRmcavGZVt/3Da2pD5NHvsOHJCrdc1G2r3DITpU7yic7w/7Rxnjc0kt5GC4djiv2Sz3Fb2iEZg41/ddsFDoyuYrIkmFehz0HR2thPgQqMyQYb2OtB0WxsZ3BeG3+wpRb1vzl2UYBog8FfGhttFKjtAclnZYrRo9ryG9uG/FZQU4AEg8ZE9LjGMzTmqKXPLnlWVnIlQQTvxJf8ip7VgjZjyVPrjw1te5otM7RmP7xm+sK2Gv9I8Gi++BRbEkR9EBw8zRUcKxwp73xkaLiqQb+kGduJTNHG72zcW9LoJgqQxpP3/Tj//c3yB0tqzaml05/+orHLksVO+95kX7/7qgJvnjlrfr2Ggsyx0eoy9uPzN5SPd86aXggOsEKW2Prz7du3VID3/tzs/sSRs2w7ovVHKtjrX2pd7ZMlTxAYfBAL9jiDwfLkq55Tm7ifhMlTGPyCAs7RFRhn47JnlcB9RM5T97ASuZXIcVNuUDIndpDbdsfrqsOppeXl5Y+XVKdjFCTh+zGaVuj0d9zy05PPK3QzBamxdwtTCrzyg/2Rvf2EstUjordGwa/kx9mSJLr8mLLtCW8HHGJc2R5hS219IiF6PnTusOqcMl57gm0Z8kanKMAQg0qSyuZfn7zItsbGyO9QlnxY0eCuD1XL2ys/MsrQhltE7Ug0uFOzufJFE2PxBo/YAx8XPPdDwWN0MrDRYIZF0mSMKCNHgaIVFoBbNoLJ7tEQDKxGF0kcLQimojCZopv0OkNOyWCCg9XMVAi7ARJzQdM2QUh0gmBozjc3Skg6dSBRqDGYSUOu66Zg+I2fNZs/M3/f/Grl/XnyF1Gw3VKCez0PN5IUfFLqvgUN4C0qNqYs5YhPL+aVZYDE4IpUk57oSFnJm4FyCqqOE0jhY2SMyLFoo56zyo6becOS5UVDdj7Vih0zp+tcMhwRpBeLyqtIjlJKAIZSbI8SGSF3k0pA3mR5tHuwPFoa7N7reoq2bqCsAk1HqCu5uvI1n6JuRXI+S1Mco54YmYTwcn6Aeic+kssXi8XpXC4V3t7/ADuTNKaQJdScAAAAAElFTkSuQmCC">
    </a>
    <br/>
</p>
<p align="left">
    <a href="https://w3id.org/ro-id/91046403-e0b7-41d3-8d60-4b540219ffa7">
        <img alt="RoHub" src="https://img.shields.io/badge/RoHub-FAIR_Executable_Research_Object-2ea44f?logo=Open+Access&logoColor=blue">
    </a>
    <a href="https://zenodo.org/badge/latestdoi/638641256">
        <img alt="doi" src="https://zenodo.org/badge/638641256.svg">
    </a>
</p><section id="context">
<h2>Context<a class="headerlink" href="#context" title="Permalink to this heading">#</a></h2>
<section id="purpose">
<h3>Purpose<a class="headerlink" href="#purpose" title="Permalink to this heading">#</a></h3>
<p>The purpose of the notebook is to explore the process and demonstrate the power of using a climate simulation and observation data with a convolutional neural network in the detection of climate change and a variational inversion approach to attribute forcings to changes in global mean surface temperatures from 1900 to 2014.</p>
</section>
<section id="description">
<h3>Description<a class="headerlink" href="#description" title="Permalink to this heading">#</a></h3>
<p>The modelling pipeline consists of the following three procedures: data acquisition &amp; preprocessing, climate change detection and climate change attribution.</p>
<ul class="simple">
<li><p>Observations (OBS) of the 2 m air temperature over the continents from HadCRUT4 (Morice et al., 2012) blended with sea surface temperature from HadISST412 (Rayner et al., 2003). The outputs of ocean-atmosphere general circulation models from the Coupled Model Intercomparison Project 6 (CMIP6) (Eyring et al., 2016) are also acquired and divided into several categories based on used forcings: single-forcing simulations utilizing greenhouse gas concentration (GHG), single-forcing simulations utilizing anthropogenic aerosols (AER), single-forcing simulations utilizing natural forcings such as volcanic aerosols and solar variations (NAT), and historical simulations using all the external forcings (HIST). The data is converted into an annual mean and is spatially averaged over the globe to obtain the global mean surface temperature (GMST). Then the mean temperatures of the pre-industrial time period (1850-1900) are removed from the period of interest (1900-2014) to obtain the temperature anomalies.</p></li>
<li><p>To determine the relation between the GMST of the single-forcing models GHG, AER, NAT to that of HIST, a convolutional neural network (CNN) is trained. The CNN uses the single-forcing model simulations as input of size (3,115), and uses the HIST simulations as the target of size (1,115). To estimate whether the added non-linearities of the CNN model improve the model performance, a simple linear model is trained using the same inputs and targets.</p></li>
<li><p>The trained CNN is then used to obtain the variational inversion using the backpropagation algorithm. In this case, OBS time series are used and linked to the single-forcing models (GHG, AER, NAT).</p></li>
</ul>
<p>The model was implemented in Python 3.10 using PyTorch v1.13.0. Further details can be found in the Environmental Data Science paper <a class="reference external" href="https://doi.org/10.1017/eds.2022.17">“Detection and attribution of climate change: A deep learning and variational approach”</a>.</p>
</section>
<section id="highlights">
<h3>Highlights<a class="headerlink" href="#highlights" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Acquire, pre-process and visualize the observation and climate simulation data.</p></li>
<li><p>Train a CNN model to predict the historical simulation time series (HIST) given the three single-forcing model simulations (GHG, AER, NAT).</p></li>
<li><p>Use the trained CNN model combined with a variational approach to estimate the three forcings given observation (OBS) data.</p></li>
</ul>
</section>
<section id="abbreviations">
<h3>Abbreviations<a class="headerlink" href="#abbreviations" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>OBS - observations</p></li>
<li><p>AER - single forcing simulations utilizing anthropogenic aerosols</p></li>
<li><p>GHG - single forcing simulations utilizing greenhouse gases</p></li>
<li><p>NAT - single forcing simulations utilizing natural forcings</p></li>
<li><p>HIST - historical simulations using all external forcings</p></li>
<li><p>CMIP6 - Coupled Model Intercomparison Project 6</p></li>
<li><p>GMST - Global Mean Surface Temperature</p></li>
<li><p>CNN - Convolutional Neural Network</p></li>
<li><p>MSE - Mean Squared Error</p></li>
</ul>
</section>
<section id="contributions">
<h3>Contributions<a class="headerlink" href="#contributions" title="Permalink to this heading">#</a></h3>
<section id="notebook">
<h4>Notebook<a class="headerlink" href="#notebook" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Viktor Domazetoski (author), University of Göttingen, <a class="reference external" href="https://github.com/ViktorDomazetoski">&#64;ViktorDomazetoski</a></p></li>
<li><p>Andrés Zúñiga-González (author), University of Cambridge, <a class="reference external" href="https://github.com/ancazugo">&#64;ancazugo</a></p></li>
<li><p>Owen Allemang (author), University of Cambridge, <a class="reference external" href="https://github.com/SkirOwen">&#64;SkirOwen</a></p></li>
<li><p>Meghna Asthana (reviewer), The Alan Turing Institute, <a class="reference external" href="https://github.com/asthanameghna">&#64;asthanameghna</a></p></li>
<li><p>Nick Homer (reviewer), The University of Edinburgh, <a class="reference external" href="https://github.com/NHomer-Edi">&#64; NHomer-Edi</a></p></li>
<li><p>Devanjan Bhattacharya (reviewer), The University of Edinburgh, <a class="reference external" href="https://github.com/dbhatedin">&#64;dbhatedin</a></p></li>
</ul>
</section>
<section id="modelling-codebase">
<h4>Modelling codebase<a class="headerlink" href="#modelling-codebase" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Constantin Bône (author), UMR LOCEAN, Sorbonne Université, UMR ISIR, Sorbonne Université</p></li>
<li><p>Guillaume Gastineau (author), UMR LOCEAN, Sorbonne Université</p></li>
<li><p>Sylvie Thiria (author), UMR LOCEAN, Sorbonne Université</p></li>
<li><p>Patrick Gallinari (author), UMR ISIR, Sorbonne Université, Criteo AI Lab</p></li>
</ul>
</section>
<section id="modelling-publications">
<h4>Modelling publications<a class="headerlink" href="#modelling-publications" title="Permalink to this heading">#</a></h4>
<div class="docutils container" id="id1">
<ul class="simple">
<li id="id26"><p>Constantin Bône, Guillaume Gastineau, Sylvie Thiria, and Patrick Gallinari. Detection and attribution of climate change: a deep learning and variational approach. <em>Environmental Data Science</em>, 1:e27, 2022. <a class="reference external" href="https://doi.org/10.1017/eds.2022.17">doi:10.1017/eds.2022.17</a>.</p></li>
</ul>
</div>
</section>
<section id="dataset-documentation">
<h4>Dataset documentation<a class="headerlink" href="#dataset-documentation" title="Permalink to this heading">#</a></h4>
<div class="docutils container" id="id32">
<ul class="simple">
<li id="id58"><p>V. Eyring, S. Bony, G. A. Meehl, C. A. Senior, B. Stevens, R. J. Stouffer, and K. E. Taylor. Overview of the coupled model intercomparison project phase 6 (cmip6) experimental design and organization. <em>Geoscientific Model Development</em>, 9(5):1937–1958, 2016. URL: <a class="reference external" href="https://gmd.copernicus.org/articles/9/1937/2016/">https://gmd.copernicus.org/articles/9/1937/2016/</a>, <a class="reference external" href="https://doi.org/10.5194/gmd-9-1937-2016">doi:10.5194/gmd-9-1937-2016</a>.</p></li>
<li id="id59"><p>Colin P. Morice, John J. Kennedy, Nick A. Rayner, and Phil D. Jones. Quantifying uncertainties in global and regional temperature change using an ensemble of observational estimates: the hadcrut4 data set. <em>Journal of Geophysical Research: Atmospheres</em>, 2012. URL: <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2011JD017187">https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2011JD017187</a>, <a class="reference external" href="https://arxiv.org/abs/https://agupubs.onlinelibrary.wiley.com/doi/pdf/10.1029/2011JD017187">arXiv:https://agupubs.onlinelibrary.wiley.com/doi/pdf/10.1029/2011JD017187</a>, <a class="reference external" href="https://doi.org/https://doi.org/10.1029/2011JD017187">doi:https://doi.org/10.1029/2011JD017187</a>.</p></li>
<li id="id60"><p>N. A. Rayner, D. E. Parker, E. B. Horton, C. K. Folland, L. V. Alexander, D. P. Rowell, E. C. Kent, and A. Kaplan. Global analyses of sea surface temperature, sea ice, and night marine air temperature since the late nineteenth century. <em>Journal of Geophysical Research: Atmospheres</em>, 2003. URL: <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2002JD002670">https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2002JD002670</a>, <a class="reference external" href="https://arxiv.org/abs/https://agupubs.onlinelibrary.wiley.com/doi/pdf/10.1029/2002JD002670">arXiv:https://agupubs.onlinelibrary.wiley.com/doi/pdf/10.1029/2002JD002670</a>, <a class="reference external" href="https://doi.org/https://doi.org/10.1029/2002JD002670">doi:https://doi.org/10.1029/2002JD002670</a>.</p></li>
<li id="id61"><p>Mark Richardson, Kevin Cowtan, and Richard J Millar. Global temperature definition affects achievement of long-term climate goals. <em>Environmental Research Letters</em>, 13(5):054004, apr 2018. URL: <a class="reference external" href="https://dx.doi.org/10.1088/1748-9326/aab305">https://dx.doi.org/10.1088/1748-9326/aab305</a>, <a class="reference external" href="https://doi.org/10.1088/1748-9326/aab305">doi:10.1088/1748-9326/aab305</a>.</p></li>
</ul>
</div>
</section>
</section>
<section id="source-code">
<h3>Source code<a class="headerlink" href="#source-code" title="Permalink to this heading">#</a></h3>
<p>The notebook contributors acknowledge the authors of the paper for providing a reproducible and public code available at <a class="gitlab reference external" href="https://gitlab.com/ConstantinBone/detection-and-attribution-of-climate-change-a-deep-learning-and-variational-approach">ConstantinBone/detection-and-attribution-of-climate-change-a-deep-learning-and-variational-approach</a>. The source code of the paper was adapted to this notebook.</p>
</section>
</section>
<section id="load-libraries">
<h2>Load libraries<a class="headerlink" href="#load-libraries" title="Permalink to this heading">#</a></h2>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Math &amp; Data Libraries&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">netCDF4</span> <span class="k">as</span> <span class="nn">nc4</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">signal</span>
<span class="kn">import</span> <span class="nn">pooch</span>

<span class="sd">&quot;&quot;&quot; ML Libraries&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">import</span> <span class="nn">pickle</span>

<span class="sd">&quot;&quot;&quot; Miscellaneous Libraries&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="sd">&quot;&quot;&quot;Visualization Libraries&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s2">&quot;whitegrid&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;grid.color&quot;</span><span class="p">:</span> <span class="s2">&quot;0.5&quot;</span><span class="p">,</span> <span class="s2">&quot;axes.edgecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;0.2&quot;</span><span class="p">})</span>
<span class="n">color_palette</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;#FF8853&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#FFE174&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#007597&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#C1C36D&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#00A697&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#BC97E0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#ffc0bf&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="settings">
<h2>Settings<a class="headerlink" href="#settings" title="Permalink to this heading">#</a></h2>
<section id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this heading">#</a></h3>
<p>We start definining model settings in a dictionary of dictionaries. It contains the number of simulations per forcing per model, and the long name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;IPSL&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;IPSL-CM6A-LR&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;ACCESS&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;ACCESS-ESM1-5&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;CESM2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;CESM2&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;BCC&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;BCC-CSM2-MR &quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;CanESM5&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">65</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;CanESM5&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;FGOALS&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;FGOALs-g3&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;HadGEM3&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;HadGEM3&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;MIRO&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;MIROC6&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;ESM2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;MRI-ESM2&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;NorESM2&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;NorESM2-LM&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;CNRM&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;CNRM-CM6-1&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;GISS&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;hist-GHG&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
        <span class="s2">&quot;hist-nat&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s2">&quot;historical&quot;</span><span class="p">:</span> <span class="mi">19</span><span class="p">,</span>
        <span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;GISS-E2-1-G&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">model_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;CanESM5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CNRM&quot;</span><span class="p">,</span>
    <span class="s2">&quot;IPSL&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ACCESS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;BCC&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FGOALS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HadGEM3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;MIRO&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ESM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;NorESM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;CESM2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;GISS&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this heading">#</a></h3>
<p>We use <code class="docutils literal notranslate"><span class="pre">torch.nn</span></code> and <code class="docutils literal notranslate"><span class="pre">torch.utils.data</span></code> modules to define linear (baseline) and CNN models, and datasets, respectively.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CNN_Model</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for a Convolutional Neural Network.</span>
<span class="sd">    The CNN consists of three convolutional layers, each with a padding of 5</span>
<span class="sd">    and a kernel size of 11 that are non-linearly transformed using a hyperbolic tangent function.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    size_channel : int</span>
<span class="sd">        length of the layer (number of neurons) (defaults to 10)</span>
<span class="sd">    bias: boolean</span>
<span class="sd">        whether to add a learnable bias to the input (defaults to True)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    forward(X):</span>
<span class="sd">        Defines the computation performed at every call.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size_channel</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CNN_Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tanh</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Tanh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span>
            <span class="mi">3</span><span class="p">,</span> <span class="n">size_channel</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">bias</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>  <span class="c1"># The input layer has a size of 3 due to the three forcings [ghg, aer, nat]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span>
            <span class="n">size_channel</span><span class="p">,</span> <span class="n">size_channel</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">bias</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span>
            <span class="n">size_channel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">bias</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">5</span>
        <span class="p">)</span>  <span class="c1"># The output layer has a size of 1 as the target [hist]</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the computation performed at every call.</span>
<span class="sd">        The input goes through 2 convolutional and hyperbolic tangent layers before being</span>
<span class="sd">        transformed to float and transformed to a tensor of shape (batch_size, N_years)</span>
<span class="sd">        ---</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            x : torch.tensor of shape (batch_size, N_forcings, N_years), where the batch size defaults to 100, N_forcings equals 3 and represents the three forcings [ghg, aer, nat], and N_years equals 115 and represents the data from 1900-2014.</span>
<span class="sd">                input tensor containing the batch of data for the three forcings over the time span of interest.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Output of computation : torch.tensor of shape (batch_size, N_years)</span>
<span class="sd">                output tensor that tries to predict the historical simulations using all the external forcings as varying boundary conditions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv3</span><span class="p">(</span><span class="n">x</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="n">x</span>


<span class="k">class</span> <span class="nc">Linear_Model</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class for a Simple Linear Module used for comparison.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    bias: boolean</span>
<span class="sd">        whether to add a learnable bias to the input (defaults to False)</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    forward(X):</span>
<span class="sd">        Defines the computation performed at every call.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Linear_Model</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">bias</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the computation performed at every call.</span>
<span class="sd">        The input goes through a linear layer before being transformed to a tensor of shape [batch_size, N_years]</span>
<span class="sd">        ---</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            x : torch.tensor of size (batch_size, N_forcings, N_years), where the batch size defaults to 100, N_forcings equals 3 and represents the three forcings [ghg, aer, nat], and N_years equals 115 and represents the data from 1900-2014.</span>
<span class="sd">                input tensor containing the batch of data for the three forcings over the time span of interest.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Output of computation : torch.tensor of shape (batch_size, N_years)</span>
<span class="sd">                output tensor that tries to predict the historical simulations using all the external forcings as varying boundary conditions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">linear</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>


<span class="k">class</span> <span class="nc">MonDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A pytorch Dataset class that is used as an input for the CNN DataLoader.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ghg: list of length 12, with one torch.tensor of shape (N_simu, N_years) for each model. N_simu is dependent on the model and ranges from 3 to 50, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A list of tensors, containing the greenhouse gas (GHG) single forcing simulations for each model over the time span of interest.</span>
<span class="sd">    aer: list of length 12, with one torch.tensor of shape (N_simu, N_years) for each model. N_simu is dependent on the model and ranges from 3 to 50, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A list of tensors, containing the aerosol (AER) single forcing simulations for each model over the time span of interest.</span>
<span class="sd">    nat: list of length 12, with one torch.tensor of shape (N_simu, N_years) for each model. N_simu is dependent on the model and ranges from 2 to 30, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A list of tensors, containing the natural (NAT) single forcing simulations for each model over the time span of interest.</span>
<span class="sd">    historical: list of length 12, with one torch.tensor of shape (N_simu, N_years) for each model. N_simu is dependent on the model and ranges from 3 to 65, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A list of tensors, containing the historical (HIST) simulations using all the external forcings as varying boundary conditions for each model over the time span of interest.</span>
<span class="sd">    model_of_interest: int</span>
<span class="sd">        The index of the model to exclude (include) when creating the train (test) dataset. Set to -1 in order to include all models.</span>
<span class="sd">    dataset_type: str, one of [&quot;train&quot;, &quot;test&quot;]</span>
<span class="sd">        Whether to create a train or test dataset</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    len(N_samples):</span>
<span class="sd">        Defines the number of samples returned.</span>
<span class="sd">    __getitem__():</span>
<span class="sd">        Fetch a random data sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">,</span> <span class="n">historical</span><span class="p">,</span> <span class="n">model_of_interest</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataset_type</span><span class="o">=</span><span class="s2">&quot;train&quot;</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ghg</span> <span class="o">=</span> <span class="n">ghg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aer</span> <span class="o">=</span> <span class="n">aer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nat</span> <span class="o">=</span> <span class="n">nat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">historical</span> <span class="o">=</span> <span class="n">historical</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataset_type</span> <span class="o">=</span> <span class="n">dataset_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_of_interest</span> <span class="o">=</span> <span class="n">model_of_interest</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">50000</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the number of samples returned.</span>
<span class="sd">        ---</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            n_samples: int</span>
<span class="sd">                Number of samples to return. Defaults to 5e4.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Number of samples : int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">n_samples</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a random data sample.</span>
<span class="sd">        If self.model_of_interest is -1, no models are excluded and in both the train and test sample we randomly choose a model and then randomly choose a simulation for each forcing to add to the dataset.</span>
<span class="sd">        Otherwise, if we want to exclude a specific model, within the train set we randomly choose a model that is not the model we want to exclude, while in the test set we only acquire data from that model.</span>
<span class="sd">        ---</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            X : torch.tensor of shape (N_forcings, N_years), where N_forcings equals 3 and represents the three forcings [ghg, aer, nat], and N_years equals 115 and represents the data from 1900-2014.</span>
<span class="sd">                a tensor containing a random sample of the simulation data for the three forcings over the time span of interest.</span>
<span class="sd">            y : torch.tensor of shape (N_years, ) where N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">                a tensor containing a random sample of the historical simulation data over the time span of interest.</span>
<span class="sd">            model_idx : int</span>
<span class="sd">                the index of the model used to acquire the random sample</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_type</span> <span class="o">==</span> <span class="s2">&quot;train&quot;</span><span class="p">:</span>
            <span class="c1"># We sample a random index between 0 and 11 until we find one that is not the model we want to exclude.</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">model_idx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ghg</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">model_idx</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_of_interest</span><span class="p">:</span>
                    <span class="k">break</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset_type</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span><span class="p">:</span>
            <span class="c1"># We take the index of the model we want to include.</span>
            <span class="n">model_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_of_interest</span>
            <span class="c1"># If the model is -1, then all models can potentially be included, thus we randomly sample one of the 12 models</span>
            <span class="k">if</span> <span class="n">model_idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">model_idx</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ghg</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># We sample a simulation of each forcing of the model</span>
        <span class="n">ghg_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghg</span><span class="p">[</span><span class="n">model_idx</span><span class="p">][</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghg</span><span class="p">[</span><span class="n">model_idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">aer_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aer</span><span class="p">[</span><span class="n">model_idx</span><span class="p">][</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aer</span><span class="p">[</span><span class="n">model_idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">nat_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nat</span><span class="p">[</span><span class="n">model_idx</span><span class="p">][</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nat</span><span class="p">[</span><span class="n">model_idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">hist_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">historical</span><span class="p">[</span><span class="n">model_idx</span><span class="p">][</span>
            <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">historical</span><span class="p">[</span><span class="n">model_idx</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">ghg_sample</span><span class="p">,</span> <span class="n">aer_sample</span><span class="p">,</span> <span class="n">nat_sample</span><span class="p">))</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">hist_sample</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">model_idx</span>


<span class="k">class</span> <span class="nc">MonDataset_Inverse</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A pytorch Dataset class that is used as an input for the Inverse model DataLoader.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ghg: torch.tensor of shape (N_simu, N_years) for one climate model. N_simu is dependent on the model and ranges from 3 to 50, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A tensor, containing the greenhouse gas (GHG) single forcing simulations for one model over the time span of interest.</span>
<span class="sd">    aer: ltorch.tensor of shape (N_simu, N_years) for one climate model. N_simu is dependent on the model and ranges from 3 to 50, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A tensor, containing the aerosol (AER) single forcing simulations for for one model over the time span of interest.</span>
<span class="sd">    nat: torch.tensor of shape (N_simu, N_years) for one climate model. N_simu is dependent on the model and ranges from 2 to 30, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A tensor, containing the natural (NAT) single forcing simulations for one model over the time span of interest.</span>

<span class="sd">    Methods</span>
<span class="sd">    -------</span>
<span class="sd">    len(N_samples):</span>
<span class="sd">        Defines the number of samples returned.</span>
<span class="sd">    __getitem__():</span>
<span class="sd">        Fetch a random data sample.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ghg</span> <span class="o">=</span> <span class="n">ghg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aer</span> <span class="o">=</span> <span class="n">aer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nat</span> <span class="o">=</span> <span class="n">nat</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the number of samples returned.</span>
<span class="sd">        ---</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            N_samples: int</span>
<span class="sd">                Number of samples to return. Defaults to 5e4.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Number of samples : int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">n_samples</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a random data sample.</span>
<span class="sd">        ---</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            X : torch.tensor of shape (N_forcings, N_years), where N_forcings equals 3 and represents the three forcings [ghg, aer, nat], and N_years equals 115 and represents the data from 1900-2014.</span>
<span class="sd">                a tensor containing a random sample of the simulation data for the three forcings over the time span of interest.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ghg_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghg</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ghg</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">aer_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aer</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aer</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">nat_sample</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nat</span><span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">ghg_sample</span><span class="p">,</span> <span class="n">aer_sample</span><span class="p">,</span> <span class="n">nat_sample</span><span class="p">))</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">X</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this heading">#</a></h3>
<p>We also define some utils functions to load models/simulations, train models and compute spatial calculations.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_spatial_mean</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the spatially weighted mean over the globe.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : np.array of shape (N_years, latitude, longitude)</span>
<span class="sd">        temporal data covering the entire globe</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        obs_data_mean : np.array of shape (N_years)</span>
<span class="sd">            Annual spatially averaged observation data from 1900 to 2020.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  <span class="c1"># Initialize np array to keep the results</span>
    <span class="n">latitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="o">-</span><span class="mf">87.5</span><span class="p">,</span> <span class="mf">87.5</span><span class="p">,</span> <span class="mi">36</span>
    <span class="p">)</span>  <span class="c1"># Initialize array that contains the mean latitude coordinates of the 5 degree bands used in the spatial weighting</span>
    <span class="n">div</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
        <span class="mi">36</span>
    <span class="p">):</span>  <span class="c1"># The latitude dimension of the data is split into 36 parts of 5 degrees which is why we loop throught 36 indices</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="mi">72</span>
        <span class="p">):</span>  <span class="c1"># Similarly, the longitude dimension of the data is split into 72 parts of 5 degrees which is why we loop throught 72 indices</span>
            <span class="n">data_mean</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[:,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="n">div</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="n">data_mean</span> <span class="o">/=</span> <span class="n">div</span>
    <span class="k">return</span> <span class="n">data_mean</span>


<span class="k">def</span> <span class="nf">get_observation_data</span><span class="p">(</span><span class="n">data_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get annual observation (OBS) data of the 2 m air temperature over the continent from HadCRUT4 (Morice et al., 2012)</span>
<span class="sd">    blended with sea surface temperature from HadISST4 (Rayner et al., 2003) over the time span of interest. The data is spatially averaged</span>
<span class="sd">    ---</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        obs_data_mean : np.array of shape (121, )</span>
<span class="sd">            Annual spatially averaged observation data from 1900 to 2020.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">obs_nc</span> <span class="o">=</span> <span class="n">nc4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">+</span> <span class="s2">&quot;obs.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="n">obs_temperature_data</span> <span class="o">=</span> <span class="n">obs_nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;temperature_anomaly&quot;</span><span class="p">][:]</span>
    <span class="k">return</span> <span class="n">calculate_spatial_mean</span><span class="p">(</span><span class="n">obs_temperature_data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">calculate_preindustrial_average</span><span class="p">(</span><span class="n">forcing</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;IPSL&quot;</span><span class="p">,</span> <span class="n">physics</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate pre-industrial average between years 1850-1900 for a given forcing and model.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    forcing : str: one of [&quot;hist-GHG&quot;, &quot;hist-aer&quot;, &quot;hist-nat&quot;, &quot;historical&quot;]</span>
<span class="sd">        type of forcing used in the simulation</span>
<span class="sd">    model_name : str: one of the 12 models in the model_list</span>
<span class="sd">        model used in the simulation</span>
<span class="sd">    physics: int: one of [1, 2]</span>
<span class="sd">        parameter used for the GISS model</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        preindustrial_average : float</span>
<span class="sd">            The pre-industrial average between the years 1850-1900.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">preindustrial_average</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">36</span><span class="p">,</span> <span class="mi">72</span><span class="p">))</span>
    <span class="c1"># According to authors, for the GISS-E2-1-G, the temperature anomalies were computed separately for the</span>
    <span class="c1"># simulations using two different physics, with different schemes to calculate the aerosols indirect impact</span>
    <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s2">&quot;GISS&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">physics</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">forcing</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
                        <span class="n">simu_nc</span> <span class="o">=</span> <span class="n">nc4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">forcing</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span>
                        <span class="p">)</span>
                        <span class="n">simu_temperature_data</span> <span class="o">=</span> <span class="n">simu_nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;tas&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span>
                        <span class="n">preindustrial_average</span> <span class="o">+=</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simu_temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">7</span>
                        <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">forcing</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">:</span>
                        <span class="n">simu_nc</span> <span class="o">=</span> <span class="n">nc4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">forcing</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span>
                        <span class="p">)</span>
                        <span class="n">simu_temperature_data</span> <span class="o">=</span> <span class="n">simu_nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;tas&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span>
                        <span class="n">preindustrial_average</span> <span class="o">+=</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simu_temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>
                        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;historical&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">physics</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">forcing</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="n">simu_nc</span> <span class="o">=</span> <span class="n">nc4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">forcing</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span>
                        <span class="p">)</span>
                        <span class="n">simu_temperature_data</span> <span class="o">=</span> <span class="n">simu_nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;tas&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span>
                        <span class="n">preindustrial_average</span> <span class="o">+=</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simu_temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span>
                        <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">forcing</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
                        <span class="n">simu_nc</span> <span class="o">=</span> <span class="n">nc4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">forcing</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span>
                        <span class="p">)</span>
                        <span class="n">simu_temperature_data</span> <span class="o">=</span> <span class="n">simu_nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;tas&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span>
                        <span class="n">preindustrial_average</span> <span class="o">+=</span> <span class="p">(</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simu_temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">9</span>
                        <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">forcing</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">9</span><span class="p">:</span>
                    <span class="n">simu_nc</span> <span class="o">=</span> <span class="n">nc4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">forcing</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span>
                    <span class="p">)</span>
                    <span class="n">simu_temperature_data</span> <span class="o">=</span> <span class="n">simu_nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;tas&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span>
                    <span class="n">preindustrial_average</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simu_temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">forcing</span><span class="p">]):</span>
            <span class="n">simu_nc</span> <span class="o">=</span> <span class="n">nc4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">forcing</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
            <span class="n">simu_temperature_data</span> <span class="o">=</span> <span class="n">simu_nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;tas&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span>
            <span class="n">preindustrial_average</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">simu_temperature_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">forcing</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">preindustrial_average</span>


<span class="k">def</span> <span class="nf">get_simulation</span><span class="p">(</span><span class="n">simulation_index</span><span class="p">,</span> <span class="n">forcing</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;IPSL&quot;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a simulation for a given forcing and model.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulation_index : int</span>
<span class="sd">        the index of the requested simulation</span>
<span class="sd">    forcing : str: one of [&quot;hist-GHG&quot;, &quot;hist-aer&quot;, &quot;hist-nat&quot;, &quot;historical&quot;]</span>
<span class="sd">        type of forcing used in the simulation</span>
<span class="sd">    model_name : str: one of the 12 models in the model_list</span>
<span class="sd">        model used in the simulation</span>
<span class="sd">    filter : boolean. Defaults to False.</span>
<span class="sd">        whether to apply a lowpass filter to the GHG and AER forcings</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        simulation : np.array of shape (N_years), where N_years equals 115</span>
<span class="sd">            The data from one simulation for a given forcing and climate model for the years 1900-2014, from which the pre-industrial average is excluded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Calculate pre-industrial average</span>
    <span class="n">physics</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s2">&quot;GISS&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">forcing</span> <span class="o">==</span> <span class="s2">&quot;hist-aer&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">simulation_index</span> <span class="o">&gt;=</span> <span class="mi">6</span> <span class="ow">and</span> <span class="n">simulation_index</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">):</span>
            <span class="n">physics</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="n">forcing</span> <span class="o">==</span> <span class="s2">&quot;historical&quot;</span> <span class="ow">and</span> <span class="n">simulation_index</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">physics</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">preindustrial_average</span> <span class="o">=</span> <span class="n">calculate_preindustrial_average</span><span class="p">(</span>
        <span class="n">forcing</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="n">physics</span><span class="o">=</span><span class="n">physics</span>
    <span class="p">)</span>

    <span class="c1"># Calculate post-industrial 1900-2015 average</span>
    <span class="n">simu_nc</span> <span class="o">=</span> <span class="n">nc4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_dir</span><span class="si">}{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">forcing</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">simulation_index</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span>
    <span class="p">)</span>
    <span class="n">simu_temperature_data</span> <span class="o">=</span> <span class="n">simu_nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;tas&quot;</span><span class="p">][</span><span class="mi">50</span><span class="p">:]</span>

    <span class="c1"># Subtract preindustrial average from the post-industrial data</span>
    <span class="n">simu_temperature_data</span> <span class="o">=</span> <span class="n">simu_temperature_data</span> <span class="o">-</span> <span class="n">preindustrial_average</span>
    <span class="n">simulation</span> <span class="o">=</span> <span class="n">calculate_spatial_mean</span><span class="p">(</span><span class="n">simu_temperature_data</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">filter</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">forcing</span> <span class="o">==</span> <span class="s2">&quot;hist-GHG&quot;</span> <span class="ow">or</span> <span class="n">forcing</span> <span class="o">==</span> <span class="s2">&quot;hist-aer&quot;</span><span class="p">:</span>
            <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span>
                <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s2">&quot;lowpass&quot;</span>
            <span class="p">)</span>  <span class="c1"># Lowpass used in the filtrage of the data</span>
            <span class="n">simulation</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">simulation</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">simulation</span>


<span class="k">def</span> <span class="nf">get_all_simulations</span><span class="p">(</span><span class="n">forcing</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;IPSL&quot;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all simulations for a given forcing and model.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    forcing : str: one of [&quot;hist-GHG&quot;, &quot;hist-aer&quot;, &quot;hist-nat&quot;, &quot;historical&quot;]</span>
<span class="sd">        type of forcing used in the simulation</span>
<span class="sd">    model_name : str: one of the 12 models in the model_list</span>
<span class="sd">        model used in the simulation</span>
<span class="sd">    filter : boolean. Defaults to False.</span>
<span class="sd">        whether to apply a lowpass filter to the GHG and AER forcings</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        simulation_data : np.array of shape (N_simu, N_years), where N_simu is dependent on the model and ranges from 3 to 50, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">            The data from all simulations for a given forcing and climate model for the years 1900-2014, from which the pre-industrial average is excluded.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">simulation_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">forcing</span><span class="p">],</span> <span class="mi">115</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_name</span><span class="p">][</span><span class="n">forcing</span><span class="p">]):</span>
        <span class="n">simulation_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_simulation</span><span class="p">(</span>
            <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">forcing</span><span class="o">=</span><span class="n">forcing</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span>
        <span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">115</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">simulation_data</span>


<span class="k">def</span> <span class="nf">get_model_dataset</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;ALL&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the entire dataset (all simulations for all forcings) for a climate model or all climate models.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model_name : str: one of the 12 models in the model_list or &quot;ALL&quot; to acquire dataset for all climate models</span>
<span class="sd">        model used in the simulation</span>
<span class="sd">    normalize : boolean. Defaults to True.</span>
<span class="sd">        whether to normalize all simulations by the maximum historical value</span>
<span class="sd">    filter : boolean. Defaults to False.</span>
<span class="sd">        whether to apply a lowpass filter to the GHG and AER forcings</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ghg: list of length 12, with one torch.tensor of shape (N_simu, N_years) for each model. N_simu is dependent on the model and ranges from 3 to 50, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A list of tensors, containing the greenhouse gas (GHG) single forcing simulations for each model over the time span of interest.</span>
<span class="sd">    aer: list of length 12, with one torch.tensor of shape (N_simu, N_years) for each model. N_simu is dependent on the model and ranges from 3 to 50, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A list of tensors, containing the aerosol (AER) single forcing simulations for each model over the time span of interest.</span>
<span class="sd">    nat: list of length 12, with one torch.tensor of shape (N_simu, N_years) for each model. N_simu is dependent on the model and ranges from 2 to 30, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A list of tensors, containing the natural (NAT) single forcing simulations for each model over the time span of interest.</span>
<span class="sd">    historical: list of length 12, with one torch.tensor of shape (N_simu, N_years) for each model. N_simu is dependent on the model and ranges from 3 to 65, and N_years equals 115 and represents the data from 1900-2014</span>
<span class="sd">        A list of tensors, containing the historical (HIST) simulations using all the external forcings as varying boundary conditions for each model over the time span of interest.</span>
<span class="sd">    maximum_historical_list: list of length 1 or length 12, dependent if model_name==&quot;ALL&quot;</span>
<span class="sd">        A list of maximum historical values per model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">maximum_historical_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s2">&quot;ALL&quot;</span><span class="p">:</span>
        <span class="n">aer</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ghg</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nat</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">historical</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">model_curr</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">model_list</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">model_curr</span><span class="p">)</span>
            <span class="n">aer_curr</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
                <span class="n">get_all_simulations</span><span class="p">(</span><span class="s2">&quot;hist-aer&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_curr</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span>
                    <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">115</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">ghg_curr</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
                <span class="n">get_all_simulations</span><span class="p">(</span><span class="s2">&quot;hist-GHG&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_curr</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span>
                    <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">115</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">nat_curr</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
                <span class="n">get_all_simulations</span><span class="p">(</span><span class="s2">&quot;hist-nat&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_curr</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span>
                    <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">115</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">historical_curr</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
                <span class="n">get_all_simulations</span><span class="p">(</span><span class="s2">&quot;historical&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_curr</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span>
                    <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">115</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">historical_max</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">historical_curr</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
            <span class="n">maximum_historical_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">historical_max</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
                <span class="n">aer_curr</span> <span class="o">=</span> <span class="n">aer_curr</span> <span class="o">/</span> <span class="n">historical_max</span>
                <span class="n">ghg_curr</span> <span class="o">=</span> <span class="n">ghg_curr</span> <span class="o">/</span> <span class="n">historical_max</span>
                <span class="n">nat_curr</span> <span class="o">=</span> <span class="n">nat_curr</span> <span class="o">/</span> <span class="n">historical_max</span>
                <span class="n">historical_curr</span> <span class="o">=</span> <span class="n">historical_curr</span> <span class="o">/</span> <span class="n">historical_max</span>

            <span class="n">aer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">aer_curr</span><span class="p">)</span>
            <span class="n">ghg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ghg_curr</span><span class="p">)</span>
            <span class="n">nat</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nat_curr</span><span class="p">)</span>
            <span class="n">historical</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">historical_curr</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">aer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="n">get_all_simulations</span><span class="p">(</span><span class="s2">&quot;hist-aer&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span>
                <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">115</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">ghg</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="n">get_all_simulations</span><span class="p">(</span><span class="s2">&quot;hist-GHG&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span>
                <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">115</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">nat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="n">get_all_simulations</span><span class="p">(</span><span class="s2">&quot;hist-nat&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span>
                <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">115</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">historical</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span>
            <span class="n">get_all_simulations</span><span class="p">(</span><span class="s2">&quot;historical&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span>
                <span class="p">:,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">115</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="n">historical_max</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">historical</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
        <span class="n">maximum_historical_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">historical_max</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normalize</span><span class="p">:</span>
            <span class="n">aer</span> <span class="o">=</span> <span class="n">aer</span> <span class="o">/</span> <span class="n">historical_max</span>
            <span class="n">ghg</span> <span class="o">=</span> <span class="n">ghg</span> <span class="o">/</span> <span class="n">historical_max</span>
            <span class="n">nat</span> <span class="o">=</span> <span class="n">nat</span> <span class="o">/</span> <span class="n">historical_max</span>
            <span class="n">historical</span> <span class="o">=</span> <span class="n">historical</span> <span class="o">/</span> <span class="n">historical_max</span>

    <span class="k">return</span> <span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">,</span> <span class="n">historical</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">maximum_historical_list</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">train_models</span><span class="p">(</span>
    <span class="n">train_dataloader</span><span class="p">,</span>
    <span class="n">test_dataloader</span><span class="p">,</span>
    <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
    <span class="n">N_epoch</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">size_channel</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">regularization</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train the CNN and Linear model.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    train_dataloader : pytorch Dataloader</span>
<span class="sd">        the data loader for the training set that consists of a sample of simulations from the three forcings for random climate models.</span>
<span class="sd">    test_dataloader : pytorch Dataloader</span>
<span class="sd">        the data loader for the test set that consists of a sample of simulations from the three forcings for random climate models.</span>
<span class="sd">    lr : int</span>
<span class="sd">        learning rate. Defaults to 1e-3.</span>
<span class="sd">    N_epoch : int</span>
<span class="sd">        the number of epochs used to train the model. Defaults to 1e2.</span>
<span class="sd">    size_channel : int</span>
<span class="sd">        length of the layer (number of neurons) (defaults to 10)</span>
<span class="sd">    regularization : float</span>
<span class="sd">        the amount of regularization used when training the model. Defaults to 0, representing no regularization.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    model_CNN : CNN_Model</span>
<span class="sd">        a CNN model which takes data from the three single forcing models [ghg, aer, nat] and is trained to predict the historical (HIST) simulations using all the external forcings as varying boundary conditions</span>
<span class="sd">    loss_train_CNN: list of length N_epoch</span>
<span class="sd">        list that contains the MSE loss of the model on the training set after each epoch</span>
<span class="sd">    loss_test_CNN: list of length N_epoch</span>
<span class="sd">        list that contains the MSE loss of the model on the test set after each epoch</span>
<span class="sd">    model_linear : Linear_Model</span>
<span class="sd">        a benchmark linear model which takes data from the three single forcing models [ghg, aer, nat] and is trained to predict the historical (HIST) simulations using all the external forcings as varying boundary conditions</span>
<span class="sd">    loss_train_linear: list of length N_epoch</span>
<span class="sd">        list that contains the MSE loss of the model on the training set after each epoch</span>
<span class="sd">    loss_test_linear: list of length N_epoch</span>
<span class="sd">        list that contains the MSE loss of the model on the test set after each epoch</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model_CNN</span> <span class="o">=</span> <span class="n">CNN_Model</span><span class="p">(</span><span class="n">size_channel</span><span class="o">=</span><span class="n">size_channel</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">model_linear</span> <span class="o">=</span> <span class="n">Linear_Model</span><span class="p">(</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">criterion_CNN</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
    <span class="n">criterion_linear</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>

    <span class="n">optim_CNN</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span>
        <span class="n">model_CNN</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">regularization</span>
    <span class="p">)</span>
    <span class="n">optim_linear</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span>
        <span class="n">model_linear</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">regularization</span>
    <span class="p">)</span>

    <span class="n">loss_train_CNN</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">loss_test_CNN</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">loss_train_linear</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">loss_test_linear</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N_epoch</span><span class="p">)):</span>
        <span class="n">loss_total_train_CNN</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">loss_total_test_CNN</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">length_train_CNN</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">length_test_CNN</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">loss_total_train_linear</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">loss_total_test_linear</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">length_train_linear</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">length_test_linear</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">model_idx</span> <span class="ow">in</span> <span class="n">test_dataloader</span><span class="p">:</span>
                <span class="n">y_hat_test_CNN</span> <span class="o">=</span> <span class="n">model_CNN</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
                <span class="n">loss_test</span> <span class="o">=</span> <span class="n">criterion_CNN</span><span class="p">(</span><span class="n">y_hat_test_CNN</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
                <span class="n">loss_total_test_CNN</span> <span class="o">+=</span> <span class="n">loss_test</span>
                <span class="n">length_test_CNN</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">y_hat_test_linear</span> <span class="o">=</span> <span class="n">model_linear</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
                <span class="n">loss_test</span> <span class="o">=</span> <span class="n">criterion_linear</span><span class="p">(</span><span class="n">y_hat_test_linear</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
                <span class="n">loss_total_test_linear</span> <span class="o">+=</span> <span class="n">loss_test</span>
                <span class="n">length_test_linear</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">for</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">model_idx</span> <span class="ow">in</span> <span class="n">train_dataloader</span><span class="p">:</span>
            <span class="n">y_hat_train_CNN</span> <span class="o">=</span> <span class="n">model_CNN</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion_CNN</span><span class="p">(</span><span class="n">y_hat_train_CNN</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">optim_CNN</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">loss_total_train_CNN</span> <span class="o">+=</span> <span class="n">loss</span>
            <span class="n">optim_CNN</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">length_train_CNN</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="n">y_hat_train_linear</span> <span class="o">=</span> <span class="n">model_linear</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion_linear</span><span class="p">(</span><span class="n">y_hat_train_linear</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="n">optim_linear</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">loss_total_train_linear</span> <span class="o">+=</span> <span class="n">loss</span>
            <span class="n">optim_linear</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
            <span class="n">length_train_linear</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">loss_total_train_CNN</span> <span class="o">=</span> <span class="n">loss_total_train_CNN</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="n">length_train_CNN</span>
        <span class="n">loss_total_test_CNN</span> <span class="o">=</span> <span class="n">loss_total_test_CNN</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="n">length_test_CNN</span>
        <span class="n">loss_total_train_linear</span> <span class="o">=</span> <span class="n">loss_total_train_linear</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="n">length_train_linear</span>
        <span class="n">loss_total_test_linear</span> <span class="o">=</span> <span class="n">loss_total_test_linear</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">/</span> <span class="n">length_test_linear</span>

        <span class="k">if</span> <span class="nb">iter</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="nb">iter</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">CNN: training loss: </span><span class="si">{</span><span class="n">loss_total_train_CNN</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, test loss </span><span class="si">{</span><span class="n">loss_total_test_CNN</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Linear: training loss: </span><span class="si">{</span><span class="n">loss_total_train_linear</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, test loss </span><span class="si">{</span><span class="n">loss_total_test_linear</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">loss_train_CNN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_total_train_CNN</span><span class="p">)</span>
        <span class="n">loss_test_CNN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_total_test_CNN</span><span class="p">)</span>

        <span class="n">loss_train_linear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_total_train_linear</span><span class="p">)</span>
        <span class="n">loss_test_linear</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss_total_test_linear</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span>
        <span class="n">model_CNN</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">loss_train_CNN</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">loss_test_CNN</span><span class="p">),</span>
        <span class="n">model_linear</span><span class="p">,</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">loss_train_linear</span><span class="p">),</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">loss_test_linear</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">train_inverse_model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.005</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform backpropagation of the CNN model to obtain the variational inverse model estimates.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    inputs : torch.tensor() of shape (3,115)</span>
<span class="sd">        a tensor that consists of a sample of simulations from the three forcings for random climate models.</span>
<span class="sd">    target : torch.tensor() of shape (1,115)</span>
<span class="sd">        a tensor that consists of the observation data</span>
<span class="sd">    model : CNN_Model()</span>
<span class="sd">        the convolutional model trained to predict HIST given [ghg, aer, nat] as input</span>
<span class="sd">    max_iter : int</span>
<span class="sd">        the maximum number of iterations used in the model. Defaults to 1e5.</span>
<span class="sd">    alpha : float</span>
<span class="sd">        the loss threshold to perform early model stopping. Defaults to 0.005.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    X : torch.tensor()</span>
<span class="sd">        The input that corresponds to the OBS data as determined by the inverse model</span>
<span class="sd">    output_estimate: torch.tensor()</span>
<span class="sd">        The model prediction for the determined input</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">Variable</span><span class="p">(</span><span class="n">inputs</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">(),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">([</span><span class="n">X</span><span class="p">],</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>

    <span class="k">for</span> <span class="nb">iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
        <span class="n">output_estimate</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">MSE_loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output_estimate</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">target</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
        <span class="n">penalization_term_loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">inputs</span><span class="o">.</span><span class="n">float</span><span class="p">())</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">MSE_loss</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">penalization_term_loss</span>

        <span class="k">if</span> <span class="nb">iter</span> <span class="o">%</span> <span class="mi">10000</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="nb">iter</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Inverse model: MSE(OBS, CNN(X)): </span><span class="si">{</span><span class="n">MSE_loss</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, MSE(X, inputs) </span><span class="si">{</span><span class="n">penalization_term_loss</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">MSE_loss</span> <span class="o">&lt;</span> <span class="n">alpha</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model achieved loss threshold at iteration </span><span class="si">{</span><span class="nb">iter</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">output_estimate</span>


<span class="k">def</span> <span class="nf">get_inverse_model_estimates</span><span class="p">(</span>
    <span class="n">observation_data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">denormalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train the CNN and Linear model.</span>
<span class="sd">    ---</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    observation_data : torch.tensor</span>
<span class="sd">        a tensor that consists of the observation data</span>
<span class="sd">    model : CNN_Model</span>
<span class="sd">        the convolutional model trained to predict HIST given [ghg, aer, nat] as input</span>
<span class="sd">    denormalize : boolean. Defaults to True.</span>
<span class="sd">        whether to denormalize all simulations by multiplying by the maximum historical value</span>
<span class="sd">    filter : boolean. Defaults to False.</span>
<span class="sd">        whether to apply a lowpass filter to the GHG and AER forcings</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    results_list_input: np.array of shape (N_models, N_forcings, N_years), where N_models = 12, N_forcings = 3, N_years = 115</span>
<span class="sd">        array that contains the inverse model input estimates of the [ghg, aer, nat] by backpropagating using the observation data</span>
<span class="sd">    results_list_output: np.array of shape (N_models, 1, N_years), where N_models = 12, N_years = 115</span>
<span class="sd">        array that contains the inverse model output estimates</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">results_list_input</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">results_list_output</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_list</span><span class="p">))):</span>
        <span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">,</span> <span class="n">historical</span><span class="p">,</span> <span class="n">maximum_historical_list</span> <span class="o">=</span> <span class="n">get_model_dataset</span><span class="p">(</span>
            <span class="n">model_name</span><span class="o">=</span><span class="n">model_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span>
        <span class="p">)</span>

        <span class="n">dataloader_inverse_model</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">MonDataset_Inverse</span><span class="p">(</span><span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">),</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">inputs</span> <span class="ow">in</span> <span class="n">dataloader_inverse_model</span><span class="p">:</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">output_estimate</span> <span class="o">=</span> <span class="n">train_inverse_model</span><span class="p">(</span>
                <span class="n">inputs</span><span class="p">,</span> <span class="n">observation_data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100000</span>
            <span class="p">)</span>

            <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
            <span class="n">output_estimate</span> <span class="o">=</span> <span class="n">output_estimate</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">denormalize</span><span class="p">:</span>
                <span class="n">X</span> <span class="o">*=</span> <span class="n">maximum_historical_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">output_estimate</span> <span class="o">*=</span> <span class="n">maximum_historical_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">results_list_input</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">results_list_output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_estimate</span><span class="p">)</span>

    <span class="n">results_list_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results_list_input</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">results_list_output</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results_list_output</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;./Results/Inverse_Results.npy&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f1</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">results_list_input</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results_list_input</span><span class="p">,</span> <span class="n">results_list_output</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="pipeline">
<h2>Pipeline<a class="headerlink" href="#pipeline" title="Permalink to this heading">#</a></h2>
<section id="fetch-data">
<h3>Fetch data<a class="headerlink" href="#fetch-data" title="Permalink to this heading">#</a></h3>
<p>The data can be found in a compressed file data_pre_ind_2 at <a class="gitlab reference external" href="https://gitlab.com/ConstantinBone/detection-and-attribution-of-climate-change-a-deep-learning-and-variational-approach">ConstantinBone/detection-and-attribution-of-climate-change-a-deep-learning-and-variational-approach</a>. We use <code class="docutils literal notranslate"><span class="pre">pooch</span></code> to fetch and unzip them directly from the GitLab repository.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pooch</span><span class="o">.</span><span class="n">retrieve</span><span class="p">(</span>
    <span class="n">url</span><span class="o">=</span><span class="s2">&quot;https://gitlab.com/ConstantinBone/detection-and-attribution-of-climate-change-a-deep-learning-and-variational-approach/-/raw/main/data_pre_ind_2.zip&quot;</span><span class="p">,</span>
    <span class="n">known_hash</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">processor</span><span class="o">=</span><span class="n">pooch</span><span class="o">.</span><span class="n">Unzip</span><span class="p">(</span><span class="n">extract_dir</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">),</span>
    <span class="n">path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">progressbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading data from &#39;https://gitlab.com/ConstantinBone/detection-and-attribution-of-climate-change-a-deep-learning-and-variational-approach/-/raw/main/data_pre_ind_2.zip&#39; to file &#39;/home/jovyan/0a6cabc0997ee6e6c798a5a8eeb76710-data_pre_ind_2.zip&#39;.
100%|███████████████████████████████████████| 799M/799M [00:00&lt;00:00, 1.45TB/s]
SHA256 hash of downloaded file: 5199a20e4f37f4bba14cb2b2630fff6d38b9e82cfbb683d4da209b25920020e2
Use this value as the &#39;known_hash&#39; argument of &#39;pooch.retrieve&#39; to ensure that the file hasn&#39;t changed if it is downloaded again in the future.
Unzipping contents of &#39;/home/jovyan/0a6cabc0997ee6e6c798a5a8eeb76710-data_pre_ind_2.zip&#39; to &#39;/home/jovyan/data&#39;
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_29.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_65.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_46.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_34.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_20.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_35.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_27.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_54.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_30.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_28.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_48.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_20.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_55.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_21.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_28.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_45.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_31.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_21.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_32.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_36.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_63.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-GHG_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_61.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_64.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_33.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_25.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_38.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_47.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_43.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_39.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_spe.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_32.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_24.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_historical_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_29.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_30.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_27.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_53.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_41.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-nat_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_42.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_40.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_50.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_25.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_38.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_23.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_25.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_47.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_34.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_49.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_26.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_28.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_24.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_20.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_23.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_40.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_52.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_25.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_49.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_29.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_60.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_22.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_42.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_21.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_58.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-GHG_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_22.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_46.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_28.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_62.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_46.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-GHG_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_43.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_36.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_24.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_25.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_33.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_44.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_39.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_24.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_40.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_41.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_32.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_29.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_32.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/obs.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_41.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_31.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_45.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-nat_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_45.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_51.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_47.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_22.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_37.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_21.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_27.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_42.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_26.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_27.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_26.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_26.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_30.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_19.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_24.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_30.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_30.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_29.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_43.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_25.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-GHG_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_20.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-GHG_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_historical_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_30.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_28.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_28.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_44.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_20.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_28.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_27.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-GHG_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_50.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_40.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_22.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_39.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_36.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_22.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_48.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_49.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_27.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_23.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_37.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_44.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-aer_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_23.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_38.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_47.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-GHG_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_27.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-aer_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_33.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_34.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-nat_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_49.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_32.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_28.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_20.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_23.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_23.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_23.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_22.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_50.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_hist-aer_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-GHG_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_24.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_31.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_44.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_38.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-aer_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_31.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_24.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_34.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_20.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-nat_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_29.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_20.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-GHG_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_27.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_42.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_30.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_39.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_26.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_45.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_59.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_20.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_26.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-aer_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_29.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_35.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_21.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_56.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_25.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_22.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_41.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_24.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_hist-GHG_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_46.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_21.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_43.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/FGOALS_historical_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_14.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_historical_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_26.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_48.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_48.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/BCC_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_21.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_21.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_35.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_historical_7.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_37.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_23.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_15.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_50.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_31.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_30.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_37.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/HadGEM3_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_5.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_6.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-GHG_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_8.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-GHG_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_11.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_36.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_33.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_historical_10.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_18.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/IPSL_hist-aer_9.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_25.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_35.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_12.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CNRM_hist-nat_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_29.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-nat_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_13.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-GHG_22.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_4.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/NorESM2_hist-GHG_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/GISS_hist-nat_1.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CESM2_hist-nat_2.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_16.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ACCESS_historical_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_historical_57.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/ESM2_hist-nat_3.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_26.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/MIRO_historical_17.nc&#39;,
 &#39;/home/jovyan/data/data_pre_ind_2/CanESM5_hist-aer_6.nc&#39;]
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="load-data">
<h3>Load data<a class="headerlink" href="#load-data" title="Permalink to this heading">#</a></h3>
<p>We first start by acquiring the annual OBS data of the 2 m air temperature over the continents from HadCRUT4 blended with sea surface temperature from HadISST4. The data is spatially averaged over the globe and only the time span of interest (1900 - 2014) is acquired. To make OBS and HIST comparable, OBS is corrected of its blending effects using a 1.06 multiplier coefficient (Richardson et al., 2018). Finally, the OBS data is normalized to a maximum of 1 by dividing the series with the OBS maximum.</p>
<p>We then get the simulation data for all forcings (GHG, AER, NAT, HIST) of all 12 climate models. The simulation data is spatially averaged over the globe to create an annual mean from which the pre-industrial average is subtracted. The simulations are then also max-normalized by dividing with the historical maximum.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set input data dir</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="s2">&quot;data/data_pre_ind_2/&quot;</span>

<span class="c1"># Get observation data</span>
<span class="n">observation_data</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">get_observation_data</span><span class="p">(</span><span class="n">data_dir</span><span class="p">))[</span><span class="mi">0</span><span class="p">:</span><span class="mi">115</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1.06</span>
<span class="n">observation_max</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">observation_data</span><span class="p">)</span>
<span class="n">observation_data</span> <span class="o">=</span> <span class="n">observation_data</span> <span class="o">/</span> <span class="n">observation_max</span>

<span class="c1"># Get the simulation data for all forcings and all climate models</span>
<span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">,</span> <span class="n">historical</span><span class="p">,</span> <span class="n">maximum_historical_list</span> <span class="o">=</span> <span class="n">get_model_dataset</span><span class="p">(</span>
    <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;ALL&quot;</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>

<span class="n">N_simu_table_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_list</span><span class="p">)):</span>
    <span class="n">N_simu_table_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">model_dict</span><span class="p">[</span><span class="n">model_list</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;long_name&quot;</span><span class="p">],</span>
            <span class="n">ghg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">aer</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">nat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">historical</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>
<span class="n">N_simu_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">N_simu_table_list</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Model&quot;</span><span class="p">,</span> <span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">,</span> <span class="s2">&quot;HIST&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/12 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CanESM5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  8%|▊         | 1/12 [00:41&lt;07:36, 41.46s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CNRM
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 17%|█▋        | 2/12 [00:48&lt;03:29, 20.95s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>IPSL
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 25%|██▌       | 3/12 [00:55&lt;02:11, 14.62s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ACCESS
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 33%|███▎      | 4/12 [01:00&lt;01:26, 10.84s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BCC
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 42%|████▏     | 5/12 [01:01&lt;00:50,  7.23s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>FGOALS
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|█████     | 6/12 [01:02&lt;00:30,  5.14s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>HadGEM3
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 58%|█████▊    | 7/12 [01:03&lt;00:19,  3.89s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MIRO
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 67%|██████▋   | 8/12 [01:14&lt;00:24,  6.15s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ESM2
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 75%|███████▌  | 9/12 [01:16&lt;00:14,  4.78s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NorESM2
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 83%|████████▎ | 10/12 [01:17&lt;00:07,  3.59s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CESM2
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 92%|█████████▏| 11/12 [01:18&lt;00:02,  2.97s/it]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GISS
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 12/12 [01:23&lt;00:00,  6.92s/it]
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table1_models_fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0.16</span><span class="p">))</span>

<span class="n">rcolors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">BuPu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">N_simu_table</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">))</span>
<span class="n">ccolors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">BuPu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">N_simu_table</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="mf">0.3</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">table</span><span class="p">(</span>
    <span class="n">cellText</span><span class="o">=</span><span class="n">N_simu_table</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
    <span class="n">rowLabels</span><span class="o">=</span><span class="n">N_simu_table</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
    <span class="n">colLabels</span><span class="o">=</span><span class="n">N_simu_table</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="n">cellLoc</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
    <span class="n">rowColours</span><span class="o">=</span><span class="n">rcolors</span><span class="p">,</span>
    <span class="n">colColours</span><span class="o">=</span><span class="n">ccolors</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># add title to table</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Number of Simulations per Model per Forcing&quot;</span><span class="p">)</span>
<span class="c1"># turn axes off</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
<span class="n">table1_models_fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/fbd28b8c916d4f8a28a997f4612dcd189e94eb83f785aa16f67e349ac9491bb3.png" src="../../../_images/fbd28b8c916d4f8a28a997f4612dcd189e94eb83f785aa16f67e349ac9491bb3.png" />
</div>
</div>
<p>To visualize the intra-specific and inter-specific variation of the simulations for the 12 climate models, we plot the three single-forcing simulations: GHG (orange), AER (yellow), NAT (blue) and the historical simulation using all external forcings: HIST (olive) for each model. The mean value of the simulations per forcing are shown with a solid line, while the shaded color represents one standard deviation off the mean. The observation data: OBS is also shown with a black dotted line.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig1_models</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Visualization of the simulations of the 12 models&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_list</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_list</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;long_name&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">forcing</span><span class="p">,</span> <span class="n">forcing_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">([</span><span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">,</span> <span class="n">historical</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">,</span> <span class="s2">&quot;HIST&quot;</span><span class="p">])</span>
    <span class="p">):</span>
        <span class="n">forcing_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">forcing</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">forcing_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">forcing</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">forcing_mean</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">forcing_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">115</span><span class="p">),</span>
            <span class="n">forcing_mean</span> <span class="o">-</span> <span class="n">forcing_std</span><span class="p">,</span>
            <span class="n">forcing_mean</span> <span class="o">+</span> <span class="n">forcing_std</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">observation_data</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444444&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OBS&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span> <span class="o">+</span> <span class="mi">1900</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)],</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)],</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">handles</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">,</span> <span class="s2">&quot;HIST&quot;</span><span class="p">,</span> <span class="s2">&quot;OBS&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GMST (</span><span class="se">\N{DEGREE SIGN}</span><span class="s2">C)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Years&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/4043f825f296ff675268833d322ddf7eb48471fd951c9523950f3b5dd158999c.png" src="../../../_images/4043f825f296ff675268833d322ddf7eb48471fd951c9523950f3b5dd158999c.png" />
</div>
</div>
<p>The following figure shows the variation of the forcings across all 12 climate models. The same color code as the previous figure is used.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_models_mean</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
    <span class="s2">&quot;Mean and standard deviation of the simulations of the 12 models&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">forcing</span><span class="p">,</span> <span class="n">forcing_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="nb">zip</span><span class="p">([</span><span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">,</span> <span class="n">historical</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">,</span> <span class="s2">&quot;HIST&quot;</span><span class="p">])</span>
<span class="p">):</span>
    <span class="n">forcing_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">forcing</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">forcing_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">forcing</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">forcing_mean</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">forcing_name</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">115</span><span class="p">),</span>
        <span class="n">forcing_mean</span> <span class="o">-</span> <span class="n">forcing_std</span><span class="p">,</span>
        <span class="n">forcing_mean</span> <span class="o">+</span> <span class="n">forcing_std</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">observation_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444444&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OBS&quot;</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span> <span class="o">+</span> <span class="mi">1900</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)],</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)],</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GMST (</span><span class="se">\N{DEGREE SIGN}</span><span class="s2">C)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Years&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">,</span> <span class="s2">&quot;HIST&quot;</span><span class="p">,</span> <span class="s2">&quot;OBS&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/53a3f5d7bbd0e175369710b717afe693aee64880bc64b0d0a695ff6b98113ea9.png" src="../../../_images/53a3f5d7bbd0e175369710b717afe693aee64880bc64b0d0a695ff6b98113ea9.png" />
</div>
</div>
</section>
</section>
<section id="cnn">
<h2>CNN<a class="headerlink" href="#cnn" title="Permalink to this heading">#</a></h2>
<section id="model-training">
<h3>Model training<a class="headerlink" href="#model-training" title="Permalink to this heading">#</a></h3>
<div class="alert alert-warning">
<p><strong>Note:</strong>
If relevant, you can train CNN models in your available local/remote machine by converting below Python markdown cells to code. The current version load pretrained models in <code class="docutils literal notranslate"><span class="pre">.pkl</span></code> format available in <code class="docutils literal notranslate"><span class="pre">outputs/models</span></code>.</p>
</div>
<p>To train the model for the detection of climate change given the single-forcing simulations, we first define a custom dataloader. The data loader works such that it randomly picks a model and a simulation index to create a data sample of input (GHG, AER, NAT) and a target (HIST).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">train_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">MonDataset</span><span class="p">(</span><span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">,</span> <span class="n">historical</span><span class="p">,</span> <span class="n">model_of_interest</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataset_type</span> <span class="o">=</span> <span class="s1">&#39;train&#39;</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
<span class="n">test_dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">MonDataset</span><span class="p">(</span><span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">,</span> <span class="n">historical</span><span class="p">,</span> <span class="n">model_of_interest</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dataset_type</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">BATCH_SIZE</span><span class="p">)</span>
</pre></div>
</div>
<p>The train and test dataloaders are then used as input to a convolutional network with three convolutional layers and a hyperbolic tangent activation function. As a result of the function, we receive the trained CNN model, as well as a linear model which is used for comparison.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_CNN</span><span class="p">,</span> <span class="n">loss_train_CNN</span><span class="p">,</span> <span class="n">loss_test_CNN</span><span class="p">,</span> <span class="n">model_linear</span><span class="p">,</span> <span class="n">loss_train_linear</span><span class="p">,</span> <span class="n">loss_test_linear</span> <span class="o">=</span> <span class="n">train_models</span><span class="p">(</span><span class="n">train_dataloader</span><span class="p">,</span> <span class="n">test_dataloader</span><span class="p">,</span> <span class="n">N_epoch</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1">## Save training/test curves</span>
<span class="n">loss_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;loss_train_CNN&#39;</span><span class="p">:</span> <span class="n">loss_train_CNN</span><span class="p">,</span> <span class="s1">&#39;loss_train_linear&#39;</span><span class="p">:</span> <span class="n">loss_train_linear</span><span class="p">,</span>
                 <span class="s1">&#39;loss_test_CNN&#39;</span><span class="p">:</span> <span class="n">loss_test_CNN</span><span class="p">,</span> <span class="s1">&#39;loss_test_linear&#39;</span><span class="p">:</span> <span class="n">loss_test_linear</span><span class="p">})</span>
<span class="n">loss_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;outputs/results/models_loss_history.csv&#39;</span><span class="p">)</span>

<span class="c1">## Save models</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model_CNN</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;Models/CNN_model.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
<span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model_linear</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;Models/Linear_model.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="model-performance">
<h3>Model performance<a class="headerlink" href="#model-performance" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">## Load models</span>
<span class="n">model_linear</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;outputs/models/Linear_model.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>
<span class="n">model_CNN</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;outputs/models/CNN_model.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">))</span>

<span class="c1">## Load loss curves</span>
<span class="n">loss_curves_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;outputs/models/models_loss_history.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">skip_first_epochs</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">fig_train_history</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Loss per Epoch of the CNN and Linear models&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">loss_list</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="nb">zip</span><span class="p">(</span>
        <span class="p">[</span><span class="n">loss_curves_df</span><span class="p">[</span><span class="s2">&quot;loss_train_CNN&quot;</span><span class="p">],</span> <span class="n">loss_curves_df</span><span class="p">[</span><span class="s2">&quot;loss_test_CNN&quot;</span><span class="p">]],</span>
        <span class="p">[</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">loss_list</span><span class="p">[</span><span class="n">skip_first_epochs</span><span class="p">:],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;CNN Model </span><span class="si">{</span><span class="n">dataset_type</span><span class="si">}</span><span class="s2"> Loss&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">loss_list</span><span class="p">,</span> <span class="n">dataset_type</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="nb">zip</span><span class="p">(</span>
        <span class="p">[</span><span class="n">loss_curves_df</span><span class="p">[</span><span class="s2">&quot;loss_train_linear&quot;</span><span class="p">],</span> <span class="n">loss_curves_df</span><span class="p">[</span><span class="s2">&quot;loss_test_linear&quot;</span><span class="p">]],</span>
        <span class="p">[</span><span class="s2">&quot;Train&quot;</span><span class="p">,</span> <span class="s2">&quot;Test&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">loss_list</span><span class="p">[</span><span class="n">skip_first_epochs</span><span class="p">:],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Linear Model </span><span class="si">{</span><span class="n">dataset_type</span><span class="si">}</span><span class="s2"> Loss&quot;</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;# Epochs&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;MSE Loss&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/a466d1d69a6d206c8994ddd66980c1169b76002dd68940a1129345d9981f85e0.png" src="../../../_images/a466d1d69a6d206c8994ddd66980c1169b76002dd68940a1129345d9981f85e0.png" />
</div>
</div>
</section>
</section>
<section id="inverse-model">
<h2>Inverse model<a class="headerlink" href="#inverse-model" title="Permalink to this heading">#</a></h2>
<div class="alert alert-warning">
<p><strong>Note:</strong>
This step benefits from GPU’s processing power. We suggest to run the <code class="docutils literal notranslate"><span class="pre">get_inverse_model_estimates</span></code> in your available local/remote machine (e.g. Colab) by converting below Python markdown cell to code. The current version load results in <code class="docutils literal notranslate"><span class="pre">.npy</span></code> format available in <code class="docutils literal notranslate"><span class="pre">outputs/results</span></code>.</p>
</div>
<p>Finally, we use trained CNN model to estimate the contribution of each forcing in the multi-model dataset using variational inversion. This is done by using the OBS data as the target variable of the CNN model and backpropagating until we get estimates of the input.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results_list_input</span><span class="p">,</span> <span class="n">results_list_output</span> <span class="o">=</span> <span class="n">get_inverse_model_estimates</span><span class="p">(</span><span class="n">observation_data</span><span class="p">,</span> <span class="n">model_CNN</span><span class="p">,</span>  <span class="n">denormalize</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load inverse model results</span>
<span class="n">results_list_input</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;./outputs/results/Inverse_Results.npy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we visualize the variational inverse model estimates for each model compared to the climate model simulations. We plot the three single-forcing simulations: GHG (orange), AER (yellow), NAT (blue) for the inverse estimates (dashed line) and the original climate model simulations (solid line). The color shades show one standard deviation across the inversion (dashed area) and the simulations. The observation data: OBS is also shown with a black dotted line.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_inverse_models</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
    <span class="s2">&quot;Mean and standard deviation of the inverse model estimates of the simulations&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_list</span><span class="p">)):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">model_dict</span><span class="p">[</span><span class="n">model_list</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;long_name&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">forcing</span><span class="p">,</span> <span class="n">forcing_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">([</span><span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">])</span>
    <span class="p">):</span>
        <span class="n">forcing_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">forcing</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">forcing_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">forcing</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">forcing_mean_inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span>
            <span class="n">results_list_input</span><span class="p">[</span><span class="mi">100</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">forcing_std_inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span>
            <span class="n">results_list_input</span><span class="p">[</span><span class="mi">100</span> <span class="o">*</span> <span class="n">i</span> <span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">)[</span><span class="n">j</span><span class="p">]</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">forcing_mean</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">forcing_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">115</span><span class="p">),</span>
            <span class="n">forcing_mean</span> <span class="o">-</span> <span class="n">forcing_std</span><span class="p">,</span>
            <span class="n">forcing_mean</span> <span class="o">+</span> <span class="n">forcing_std</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">forcing_mean_inverse</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">forcing_name</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">115</span><span class="p">),</span>
            <span class="n">forcing_mean_inverse</span> <span class="o">-</span> <span class="n">forcing_std_inverse</span><span class="p">,</span>
            <span class="n">forcing_mean_inverse</span> <span class="o">+</span> <span class="n">forcing_std_inverse</span><span class="p">,</span>
            <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;////&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">j</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">observation_data</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444444&quot;</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OBS&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span> <span class="o">+</span> <span class="mi">1900</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)],</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
        <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)],</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">handles</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">,</span> <span class="s2">&quot;HIST&quot;</span><span class="p">,</span> <span class="s2">&quot;OBS&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GMST (</span><span class="se">\N{DEGREE SIGN}</span><span class="s2">C)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Years&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/8668a6093000d6520ffd83c1ab398e570f12426e760295e7ed5ff6cf225fe7a7.png" src="../../../_images/8668a6093000d6520ffd83c1ab398e570f12426e760295e7ed5ff6cf225fe7a7.png" />
</div>
</div>
<p>The following figure visualizes the same figure by taking all models into account. The same color as the previous figure is used.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig_inverse_models_mean</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
    <span class="s2">&quot;Mean and standard deviation of the inverse model estimates of the simulations&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">forcing</span><span class="p">,</span> <span class="n">forcing_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="nb">zip</span><span class="p">([</span><span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">])</span>
<span class="p">):</span>
    <span class="n">forcing_std</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">forcing</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">forcing_mean</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">forcing</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">forcing_mean_inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results_list_input</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">forcing_std_inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">results_list_input</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">forcing_mean</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">forcing_name</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">115</span><span class="p">),</span>
        <span class="n">forcing_mean</span> <span class="o">-</span> <span class="n">forcing_std</span><span class="p">,</span>
        <span class="n">forcing_mean</span> <span class="o">+</span> <span class="n">forcing_std</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">forcing_mean_inverse</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">forcing_name</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">115</span><span class="p">),</span>
        <span class="n">forcing_mean_inverse</span> <span class="o">-</span> <span class="n">forcing_std_inverse</span><span class="p">,</span>
        <span class="n">forcing_mean_inverse</span> <span class="o">+</span> <span class="n">forcing_std_inverse</span><span class="p">,</span>
        <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;////&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">observation_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444444&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OBS&quot;</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span> <span class="o">+</span> <span class="mi">1900</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)],</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)],</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Years&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GMST (</span><span class="se">\N{DEGREE SIGN}</span><span class="s2">C)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handles</span><span class="p">,</span>
    <span class="p">[</span>
        <span class="s2">&quot;GHG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Inversion of GHG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AER&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Inversion of AER&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NAT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Inversion of NAT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OBS&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/a4c33633e670d146bfb37ad412b5d356d0a492a908290eeb41514e0b6cd200bc.png" src="../../../_images/a4c33633e670d146bfb37ad412b5d356d0a492a908290eeb41514e0b6cd200bc.png" />
</div>
</div>
<p>Finally, we visualize the mean and standard deviation of the variational inverse model estimates over time, and further show the results for two years, in this case 1993 and 2014 for greenhouse gases (orange), anthropogenic aerosols (yellow) and natural forcings (blue).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig2_inverse_estimates</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">12.4</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width_ratios&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
    <span class="s2">&quot;Mean and standard deviation of the inverse model estimates of the simulations&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">forcing</span><span class="p">,</span> <span class="n">forcing_name</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
    <span class="nb">zip</span><span class="p">([</span><span class="n">ghg</span><span class="p">,</span> <span class="n">aer</span><span class="p">,</span> <span class="n">nat</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">])</span>
<span class="p">):</span>
    <span class="n">forcing_mean_inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">results_list_input</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">forcing_std_inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">results_list_input</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">forcing_mean_inverse</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">forcing_name</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">115</span><span class="p">),</span>
        <span class="n">forcing_mean_inverse</span> <span class="o">-</span> <span class="n">forcing_std_inverse</span><span class="p">,</span>
        <span class="n">forcing_mean_inverse</span> <span class="o">+</span> <span class="n">forcing_std_inverse</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
    <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">observation_data</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#444444&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;OBS&quot;</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tick</span> <span class="o">+</span> <span class="mi">1900</span><span class="p">)</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)],</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">tick</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)],</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Years&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GMST (</span><span class="se">\N{DEGREE SIGN}</span><span class="s2">C)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handles</span><span class="p">,</span>
    <span class="p">[</span><span class="s2">&quot;Inversion of GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;Inversion of AER&quot;</span><span class="p">,</span> <span class="s2">&quot;Inversion of NAT&quot;</span><span class="p">,</span> <span class="s2">&quot;OBS&quot;</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">1993</span><span class="p">,</span> <span class="mi">2014</span><span class="p">]):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">year_ind</span> <span class="o">=</span> <span class="n">year</span> <span class="o">-</span> <span class="mi">1900</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">forcing_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s2">&quot;GHG&quot;</span><span class="p">,</span> <span class="s2">&quot;AER&quot;</span><span class="p">,</span> <span class="s2">&quot;NAT&quot;</span><span class="p">]):</span>
        <span class="n">result_forcing_year</span> <span class="o">=</span> <span class="n">results_list_input</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">year_ind</span><span class="p">]</span>
        <span class="c1"># bin = int(round((np.max(result_forcing_year) - np.min(result_forcing_year)) * 10)) +1</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">results_list_input</span><span class="p">[:,</span> <span class="n">i</span><span class="p">,</span> <span class="n">year_ind</span><span class="p">],</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color_palette</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GMST (</span><span class="se">\N{DEGREE SIGN}</span><span class="s2">C)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../../_images/4a28c31333047f3e654f28c2d874dae58b62d012a0a3548a958c9da38f62d74f.png" src="../../../_images/4a28c31333047f3e654f28c2d874dae58b62d012a0a3548a958c9da38f62d74f.png" />
</div>
</div>
<p>As we can see in the left panel of the image, the results are comparable to the original simulations, however, with a slightly increased standard deviation. The right panel illustrates the distribution of the results from the inversions in 1993 and 2014, showing a clear delineation between the effect of GHG compared to AER and NAT forcings. Furthermore, this results obtained in this run of the notebook slighly differ from the ones in the original paper. This could be due to multiple reasons, such as the stochasticity involved in training the models or slight differences in the pipeline compared to the original paper.</p>
</section>
<section id="limitations">
<h2>Limitations<a class="headerlink" href="#limitations" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Data uncertainty: The analysis relies on the the accuracy and quality of the data which is used to train the models. However, especially when using the climate simulation data (GHG, AER, NAT, HIST), we rely on the use of climate models which inherently carry uncertainties due to simplified representations of complex climate processes, thus can bias the changes to specific forcings.</p></li>
<li><p>Spatiotemporal resolution: The analysis provides GMST attribution on a global scale, but it may not capture regional variations adequately. Regional climate responses and localized forcings might not be fully accounted for, limiting the ability to attribute changes at finer spatial scales. However, this is something the authors of the paper discuss they will research in future work.</p></li>
<li><p>Incomplete forcings: The analysis focuses on attributing GMST changes to well-mixed greenhouse gases, anthropogenic aerosols, and natural forcings. However, other external factors, such as land-use changes or solar variability, may also contribute to GMST variations and are not explicitly considered in this analysis.</p></li>
<li><p>Future projection uncertainty: The analysis focuses on historical data up to 2014, and the attribution results may not fully reflect potential changes beyond that period. Projecting the attribution results into the future introduces additional uncertainties related to emission scenarios and climate model projections.</p></li>
<li><p>Sensitivity to methodology: The results of the analysis may be sensitive to the specific methodology chosen, including the design of the variational inversion approach and the choice of climate models used. Alternative methodologies could yield different attribution outcomes.</p></li>
</ul>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The climate change attribution problem is a very important issue that pertains to understanding the exact causes behind climate change. However, most approaches tackling this problem have relied on the classical forcing additivity assumption which precludes any non-linear combinations that are ubiquitous in nature.</p></li>
<li><p>In this notebook, we utilize a CNN architecture to escape this constraint and estimate the historical global mean surface temperature using single forcing simulations (greenhouse gases, anthropogenic aerosols and natural forcings) from ocean-atmosphere general circulation models from the Coupled Model Intercomparison Project 6 (CMIP6).</p></li>
<li><p>The results show that the CNN performs better and obtains a lower mean square error compared to a simpler linear model trained on the same data.</p></li>
<li><p>The trained CNN is then used with a variational inversion approach to estimate the single forcings when given observation data from HadCRUT4 and HAdISST412. The estimated inversions of the single forcings show high similarity to the original data and provide coherent results with larger confidence intervals.</p></li>
</ul>
</section>
<section id="citing-this-notebook">
<h2>Citing this Notebook<a class="headerlink" href="#citing-this-notebook" title="Permalink to this heading">#</a></h2>
<p>Please see <a class="reference external" href="https://github.com/eds-book-gallery/93463cac-471a-469d-ad52-0514fd9b67f2/blob/main/CITATION.cff">CITATION.cff</a> for the full citation information. The citation file can be exported to APA or BibTex formats (learn more <a class="reference external" href="https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/customizing-your-repository/about-citation-files">here</a>).</p>
</section>
<section id="additional-information">
<h2>Additional information<a class="headerlink" href="#additional-information" title="Permalink to this heading">#</a></h2>
<p><strong>Dataset</strong>: Bône, Constantin. (2023).  Detection and attribution of climate change a Deep Learning and Variational approach. <a class="gitlab reference external" href="https://gitlab.com/ConstantinBone/detection-and-attribution-of-climate-change-a-deep-learning-and-variational-approach/-/blob/main/data_pre_ind_2.zip">ConstantinBone/detection-and-attribution-of-climate-change-a-deep-learning-and-variational-approach/-/blob/main/data_pre_ind_2.zip</a> - Commit 8dff0335be7dbf07e56c7a99bef6b12453360012</p>
<p><strong>License</strong>: The code in this notebook is licensed under the MIT License. The Environmental Data Science book is licensed under the Creative Commons by Attribution 4.0 license. See further details <a class="reference external" href="https://github.com/alan-turing-institute/environmental-ds-book/blob/master/LICENSE.md">here</a>.</p>
<p><strong>Contact</strong>: If you have any suggestion or report an issue with this notebook, feel free to <a class="reference external" href="https://github.com/alan-turing-institute/environmental-ds-book/issues/new/choose">create an issue</a> or or send a direct message to <a class="reference external" href="mailto:environmental&#46;ds&#46;book&#37;&#52;&#48;gmail&#46;com">environmental<span>&#46;</span>ds<span>&#46;</span>book<span>&#64;</span>gmail<span>&#46;</span>com</a>.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Notebook repository version: v1.0.3
Last tested: 2024-03-11
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/gallery/93463cac-471a-469d-ad52-0514fd9b67f2"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../39d9c177-11da-41b2-9b64-63f4c1c834b3/notebook.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Variational data assimilation with deep prior (CIRC23)</p>
      </div>
    </a>
    <a class="right-next"
       href="../3286b92f-4fae-4cc6-a29e-e408bc844542/notebook.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Learning the underlying physics of a simulation model of the ocean’s temperature (CIRC23)</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#context">Context</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose">Purpose</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#highlights">Highlights</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#abbreviations">Abbreviations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#contributions">Contributions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#notebook">Notebook</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-codebase">Modelling codebase</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modelling-publications">Modelling publications</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dataset-documentation">Dataset documentation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#source-code">Source code</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-libraries">Load libraries</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#settings">Settings</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#variables">Variables</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#classes">Classes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#functions">Functions</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline">Pipeline</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fetch-data">Fetch data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-data">Load data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cnn">CNN</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-training">Model training</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#model-performance">Model performance</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inverse-model">Inverse model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limitations">Limitations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citing-this-notebook">Citing this Notebook</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-information">Additional information</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By EDS book Community. This site is powered by <a href="https://www.netlify.com/">Netlify</a>.
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2021.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>